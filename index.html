<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  
  <title>Pathwiz - Biogeochemical Pathway Visualization</title>
  <link rel="icon" type="image/x-icon" href="resources/logo_32x32.png">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="css/pathwiz.css">
</head>
<body>

<div class="app-container">
  
  <!-- Left Sidebar -->
  <div class="sidebar">
    <div>
      <h1>
        <a href="index.html" class="logo-text">
          <span class="char" style="--i:1" data-char="P">P</span>
          <span class="char" style="--i:2" data-char="a">a</span>
          <span class="char" style="--i:3" data-char="t">t</span>
          <span class="char" style="--i:4" data-char="h">h</span>
          <span class="char" style="--i:5" data-char="w">w</span>
          <span class="char" style="--i:6" data-char="i">i</span>
          <span class="char" style="--i:7" data-char="z">z</span>
        </a>
      </h1>
      <p class="description">Gain insights into biogeochemical cycles through simplified and elegant pathway visualizations.</p>
    </div>

    <div class="input-group">
      <label for="pathwaySelect">Select Pathway</label>
      <select id="pathwaySelect" class="attention-pulse" onchange="loadPathway(this.value)" onfocus="removeAttention()">
        <option value="" disabled selected>-- Select a Pathway --</option>
        <option value="js/methanogenesis.js">Methanogenesis</option>
      </select>
    </div>

    <div class="input-group">
      <label for="titleInput">Figure Title</label>
      <input type="text" id="titleInput" placeholder="(Optional)" oninput="updateTitle()">
    </div>

    <div class="input-group">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center;">
          <label for="kwInput" style="margin-bottom: 0; margin-right: 5px;">Keywords / Identifiers</label>
          <div class="tooltip-container">
            <div class="help-icon">?</div>
            <span class="tooltip-text">Currently supports KO IDs and a limited set of gene names. KO IDs are recommended for uniqueness. Using gene names may yield unexpected results in some cases.</span>
          </div>
        </div>
        <button class="btn-text" onclick="fillExample()" style="font-size: 11px; padding: 0; color: var(--primary-color);">Fill Example</button>
      </div>
      <textarea id="kwInput" placeholder="e.g. K00201, Mtt, McrA...&#10;IDs joined by commas or new lines..."></textarea>
    </div>

    <div class="button-group">
      <button class="btn-primary" onclick="highlight()">
        <span class="btn-icon"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l-6 6v3h9l3-3" /><path d="M22 12l-4.6 4.6a2 2 0 01-2.8 0l-5.2-5.2a2 2 0 010-2.8L14 4" /></svg></span>
        Highlight Pathway
      </button>
      <button class="btn-secondary" onclick="clearHighlight()">
        <span class="btn-icon"><svg viewBox="0 0 24 24" fill="#7f8c8d"><path d="M13.9907,1.31133017e-07 C14.8816,1.31133017e-07 15.3277,1.07714 14.6978,1.70711 L13.8556,2.54922 C14.421,3.15654 14.8904,3.85028 15.2448,4.60695 C15.8028,5.79836 16.0583,7.109 15.9888,8.42277 C15.9193,9.73654 15.5268,11.0129 14.8462,12.1388 C14.1656,13.2646 13.2178,14.2053 12.0868,14.8773 C10.9558,15.5494 9.67655,15.9322 8.3623,15.9918 C7.04804,16.0514 5.73937,15.7859 4.55221,15.2189 C3.36505,14.652 2.33604,13.8009 1.55634,12.7413 C0.776635,11.6816 0.270299,10.446 0.0821822,9.14392 C0.00321229,8.59731 0.382309,8.09018 0.928918,8.01121 C1.47553,7.93224 1.98266,8.31133 2.06163,8.85794 C2.20272,9.83451 2.58247,10.7612 3.16725,11.556 C3.75203,12.3507 4.52378,12.989 5.41415,13.4142 C6.30452,13.8394 7.28602,14.0385 8.27172,13.9939 C9.25741,13.9492 10.2169,13.6621 11.0651,13.158 C11.9133,12.6539 12.6242,11.9485 13.1346,11.1041 C13.6451,10.2597 13.9395,9.30241 13.9916,8.31708 C14.0437,7.33175 13.8521,6.34877 13.4336,5.45521 C13.178,4.90949 12.8426,4.40741 12.4402,3.96464 L11.7071,4.69779 C11.0771,5.32776 9.99996,4.88159 9.99996,3.99069 L9.99996,1.31133017e-07 L13.9907,1.31133017e-07 Z M1.499979,4 C2.05226,4 2.499979,4.44772 2.499979,5 C2.499979,5.55229 2.05226,6 1.499979,6 C0.947694,6 0.499979,5.55228 0.499979,5 C0.499979,4.44772 0.947694,4 1.499979,4 Z M3.74998,1.25 C4.30226,1.25 4.74998,1.69772 4.74998,2.25 C4.74998,2.80229 4.30226,3.25 3.74998,3.25 C3.19769,3.25 2.74998,2.80228 2.74998,2.25 C2.74998,1.69772 3.19769,1.25 3.74998,1.25 Z M6.99998,0 C7.55226,0 7.99998,0.447716 7.99998,1 C7.99998,1.55229 7.55226,2 6.99998,2 C6.44769,2 5.99998,1.55229 5.99998,1 C5.99998,0.447716 6.44769,0 6.99998,0 Z"></path></svg></span>
        Clear Selection
      </button>
    </div>

    <div class="switch-container">
      <span class="switch-label">Grayscale Mode</span>
      <label class="switch">
        <input type="checkbox" id="grayscaleToggle" onchange="toggleGrayscale()">
        <span class="slider"></span>
      </label>
    </div>

    <!-- Export Buttons Area -->
    <div class="input-group" style="margin-top: 10px;">
      <label>Export Figure</label>
      <div class="btn-row">
        <button class="btn-export" onclick="saveSvg()">
          <span class="btn-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-code" aria-hidden="true"><path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"></path><path d="M14 2v5a1 1 0 0 0 1 1h5"></path><path d="M10 12.5 8 15l2 2.5"></path><path d="m14 12.5 2 2.5-2 2.5"></path></svg></span>
          Save SVG
        </button>
        <button class="btn-export" onclick="saveJpg()">
          <span class="btn-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-image" aria-hidden="true"><path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"></path><path d="M14 2v5a1 1 0 0 0 1 1h5"></path><circle cx="10" cy="12" r="2"></circle><path d="m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22"></path></svg></span>
          Save JPG
        </button>
      </div>
    </div>

    <div class="footer-controls">
       <div style="font-size: 12px; color:#aaa; margin-bottom:5px;">
         Shortcut: <strong>Ctrl + Enter</strong> to highlight
       </div>
       <button class="btn-text" onclick="toggleDebug()">
         <span class="btn-icon" style="width: 14px; height: 14px; margin-right: 4px;"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bug" aria-hidden="true"><path d="M12 20v-9"></path><path d="M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z"></path><path d="M14.12 3.88 16 2"></path><path d="M21 21a4 4 0 0 0-3.81-4"></path><path d="M21 5a4 4 0 0 1-3.55 3.97"></path><path d="M22 13h-4"></path><path d="M3 21a4 4 0 0 1 3.81-4"></path><path d="M3 5a4 4 0 0 0 3.55 3.97"></path><path d="M6 13H2"></path><path d="m8 2 1.88 1.88"></path><path d="M9 7.13V6a3 3 0 1 1 6 0v1.13"></path></svg></span>
         Toggle SVG Debug Grid
       </button>
       <a href="https://github.com/SilentGene/pathwiz" target="_blank" class="btn-text" style="display: inline-flex; align-items: center; text-decoration: none; margin-top: 5px;">
         <span class="btn-icon" style="width: 16px; height: 16px; margin-right: 6px;">
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
             <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
           </svg>
         </span>
         &copy; 2025 Heyu Lin
       </a>

    </div>
  </div>

  <!-- Right Main Content Area -->
  <div class="main-content">
    <svg id="svg" viewBox="0 0 640.67 589.39" preserveAspectRatio="xMidYMid meet">
      <g id="initial-state">
        <image href="resources/logo.svg" x="220" y="150" width="200" height="200" opacity="0.5" class="logo-animate" />
        <text x="320" y="400" text-anchor="middle" font-family="Arial" font-size="16" fill="#999">Select a pathway from the left to begin</text>
      </g>
    </svg>
  </div>

</div>


<script src="js/pathwiz.js"></script>
<script>
  function removeAttention() {
    const select = document.getElementById('pathwaySelect');
    if (select) {
      select.classList.remove('attention-pulse');
      select.removeAttribute('onfocus'); // Remove listener after first use
    }
  }

  function loadPathway(scriptPath) {
    removeAttention(); // Ensure it's removed on change as well
    if (!scriptPath) return;
    
    // Clear existing pathway
    if (typeof clearPathway === 'function') {
      clearPathway();
    }
    
    // Create and append new script
    const script = document.createElement('script');
    script.src = scriptPath;
    
    script.onload = function() {
      console.log("Loaded " + scriptPath);
    };
    
    document.body.appendChild(script);
  }
</script>
</body>
</html>